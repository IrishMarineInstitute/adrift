<!DOCTYPE html>
<html>
<title>Project Status...</title>
<head>
<meta charset="utf-8">
<link rel="icon" href="/static/img/favicon.ico">
<link rel="stylesheet" href="/static/css/leaflet.css" />
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/moment.min.js"></script>
<script src="/static/js/bootstrap-datetimepicker.min.js"></script>
<script src="/static/js/leaflet.js"></script>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/css/bootstrap-datetimepicker.min.css" />
<link rel="stylesheet" href="/static/css/Leaflet.Coordinates-0.1.5.css" />
<script type="text/javascript" src="/static/js/Leaflet.Coordinates-0.1.5.min.js"></script>
<style>
#map { height: 400px; width: 600px;}
</style>
<script>
var marker = undefined;
var update_marker_location = function(){
    var newLatLng = new L.LatLng(parseFloat($("#latitude").val()),parseFloat($("#longitude").val()));
    marker.setLatLng(newLatLng); 
}

var create_map = function(){
    map = L.map('map', {
    zoom: 12,
    fullscreenControl: true,
    center: [{{latitude}}, {{longitude}}]
    });
    var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);
  L.control.coordinates({
      position: "bottomright",
      decimals: 3,
      labelTemplateLat: "Latitude: {y}",
      labelTemplateLng: "Longitude: {x}",
      useDMS: false,
      enableUserInput: false
  }).addTo(map);
  marker = L.marker([{{latitude}}, {{longitude}}],{draggable: true}).addTo(map);
  marker.on('drag',function(e){
      $("#latitude").val(e.latlng.lat);
      $("#longitude").val(e.latlng.lng);
   });
  $("#latitude").change(update_marker_location);
  $("#longitude").change(update_marker_location);
};

$(document).ready(function(){
   $("#start_time_picker").datetimepicker({format: 'yyyy-mm-dd hh:ii',  startDate: '{{date_min}}', endDate: '{{date_max}}', linkField: 'start_time', linkFormat: 'yyyy-mm-ddThh:ii:ssZ'});
   $("#end_time_picker").datetimepicker({format: 'yyyy-mm-dd hh:ii', startDate: '{{date_min}}', endDate: '{{date_max}}', linkField: 'end_time', linkFormat: 'yyyy-mm-ddThh:ii:ssZ'});
   $("form").submit(function(e){
         $("#start_time").val($("#start_time").val().substring(0,19)+"Z");
         $("#end_time").val($("#end_time").val().substring(0,19)+"Z");
   });
   create_map();
   $("#project_name").focus();
});
</script>
</head>
<body>
<div class="container">
<h1><a href="/">ADRIFT</a></h1>
<p class="lead"><a href="http://www.marine.ie/">Marine Institute</a> assisted discovery/recovery of interesting floating things.</p>
<div class="row">
<div class="col-md-12">
<form method="post" action="/api/model/{{model}}/projection">
  <h4>Enter New Project Start Location <small>or drag marker</small></h4>
  <div class="row">
   <div class="col-md-4">
    <div class="form-group">
      <label class="control-label">Latitude</label>
      <input required type="number" min="{{latitude_min}}" max="{{latitude_max}}" step="any" id="latitude" name="latitude" class="form-control" value="{{latitude}}" >
    </div>
    <div class="form-group">
      <label class="control-label">Longitude</label>
      <input required type="number" min="{{longitude_min}}" max="{{longitude_max}}" step="any" id="longitude" name="longitude" class="form-control" value="{{longitude}}" >
    </div>
  <div class="form-group">
    <label class="control-label">Start Time (UTC)</label>
    <input required id="start_time_picker" value="{{date_min}}" name="start_time_picker" size="20" type="text" readonly class="form_datetime" >
    <input type="hidden" id="start_time" name="start_time" value="{{date_min}}">
  </div>
  <div class="form-group">
    <label class="control-label">End Time (UTC)</label>
    <input required id="end_time_picker" value="{{date_max}}" name="end_time_picker" size="20" type="text" readonly class="form_datetime" >
    <input type="hidden" id="end_time" name="end_time" value="{{date_max}}">
  </div>
  <div class="form-group">
    <label class="control-label">Radius (metres)</label>
    <input required type="number" min="1" max="1000" step="1" id="radius" name="radius" class="form-control" value="250" >
  </div>
   </div>
   <div class="col-md-8">
    <div id="map"></div>
   </div>
  </div>
  <div class="form-group">
   <button type="submit" class="btn btn-default">Submit</button>
   <a href="/" class="btn btn-default">Cancel</a>
  </div>
</form>
</div>
</div>
</div>
</body>
</html>
